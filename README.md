# Marine-air-defense-simulation-based-on-Unity3D
Marine air defense simulation based on Unity in 2020

1.研究目的和意义
1.1舰艇编队联合防空场景仿真
海战场舰艇编队的组成部分通常包括：潜艇、航空兵、大中型水面舰艇，包含两个以上的海军兵种力量，编队有着共同的作战目标或其他任务，具有典型体系的作战特征，是海军执行海上作战任务的主要兵力形式，已成为当今世界海上机动作战任务中不可或缺的主要力量，其作战效能的高低关系到战局胜负。在未来的海上战场中，大量超视距、高速度的掠海高精度武器的使用必然对舰队安全造成严重威胁，这使得防空反导作战成为水面舰艇编队未来的主要作战形式，但因为受制于人力物力和财力等多种因素，频繁组织大规模海战场联合防空演习难以实现。
随着计算机技术和系统仿真技术的不断发展，各种高精度、高效率作战仿真系统被应用于武器装备测评、作战理论研究、作战方案优化、部队演习等各个方面。仿真系统主要是通过计算机对实际战场中环境、战术、态势发展进行参数化建模，通过强大的算力迅速模拟出实际战场环境下的多种复杂情况，在模拟过程中可相应指定战略战术，通过灵活调控战场发展态势参数，全面、精确的还原战场，提升军事训练效益。
Unity3D是由Unity Technologies开发的一个让玩家轻松创建诸如三维视频游戏、建筑可视化、实时三维动画等类型互动内容的多平台的综合型游戏开发工具，是一个全面整合的专业游戏引擎。Unity3D具有几个非常鲜明的优点：①可随意定制仿真场景，所见即所得；②基于组件的对象系统，可对游戏对象进行灵活的设计和功能扩充；③超实时性。Unity3D拥有的突出优点使得它在场景构建和战场仿真中丝毫不逊色于其他专业系统。利用本次所开发的Unity3D海战防空仿真平台，针对既定的作战想定方案，根据我方舰艇编队典型的作战方式，本系统推演出对应的作战方案，并由仿真平台进行模型演示，同时可在系统中监测各项实时数据，有利于战场形势分析以及作战评估。
1.2事件机制
综合国内外研究发现，现有系统的驱动方式大多分为两类：事件驱动和时间驱动，时间驱动又分为离散和连续方式。连续时间驱动控制的特点在于能及时的控制输入的更新，这种方式虽然能实现更好更全面的控制效果，但是存在着更新不及时的缺点，离散时间驱动控制是系统采用周期采样的方式，此时控制输入的更新只会在离散时间进行，相比于连续时间控制机制减少了频次。时间驱动控制相对于某些实时性要求较高的系统来说无法实现系统信息的及时更新，故引进了事件驱动机制。事件驱动机制与时间驱动机制最大的不同在于：在一段时间内，时间驱动可能需要连续或周期采样的方式来获取信息输入更新，如果这段时间内没有更新，则会浪费通信资源，事件驱动的运行机制是在开始时设置好合适的事件驱动条件，一旦系统内部的某些状态参数到达某些设置的阈值而满足事件驱动条件时，事件触发控制器随机就会进行控制输入状态的更新。事件机制的优点是具备超强的实时性且不会浪费大量的资源。在目前的ASP.NET中主要采用事件驱动机制，例如窗体加载、鼠标点击等等。
1.3国内外研究现状
目前的作战仿真系统大多数基于HLA和STAGE联合仿真平台，美国国防部高度重视仿真技术的发展，近十多年来，美国一直将建模与仿真列为重要的国防关键技术。1992年公布了“国防建模与仿真倡议”，并成立了国防建模与仿真办公室，负责倡议的实施， 1995年10月，在该办公室制定的建模与仿真主计划（MSMP）中，提出了未来建模/仿真的共同技术框架：HLA（高级体系结构，High Level Architecture)。HLA因为其强大的战场仿真能力和灵活的可扩展性，引起很多学者的学习和补充。Falcone[1]等人2017年对较为复杂的HLA模型标准以Java文件编写，实现分布式仿真组件的跨平台互操作性和可重用性。Jean-Baptiste Chaudron[3]等人该平台在通过特殊的硬件和软件环境评估和验证新的嵌入式系统概念和技术任务中讨论了使用HLA标准实现实时性能的问题，认为HLA 架构非常适合实现硬实时约束。
欧洲对于仿真的研究历来也十分重视。北大西洋公约组织（NATO）于 1992 年 9 月成立了 DIS 工作组。同年欧洲学术界的二百个成员成立了欧洲仿真特殊兴趣组，并于次年组建了"仿真未来：新概念、工具和应用"基础研究工作组。制定了仿真基础研究和开发为第一优先主题.尤其是像并行和分布式仿真这样的基础技术，围绕这个主题将就"仿真互操作性"展开行动计划。Massimo Ficco[2]等人为了在弹性和自适应本地控制的测试台上重现复杂的HLA系统架构，采用了基于云的虚拟化平台，提出了一个集成基于仿真和仿真的子系统的框架，能够为被测方案提供更高的真实性。
在其余世界各国，需要大量实验论证的科技难题也均利用作战仿真系统模拟，比如核爆模拟，导弹防御模拟等。Yuanchun Liu [6]开发了一种有效的网格分割方法和空气动力学预测系统，并由计算机模拟超音速马赫数下网格-鳍配置的粘性流场，最后通过实际数据确认该方法是数值网格翅片流场数值模拟的有效方法。
国内的军用仿真技术也已经发展了40余年之久，尤其在“十一五”以来的十多年中，通过边建边用，以及上级领导的重视，仿真技术得到了飞速发展，并在应用方面取得显著成果。有效的应用于新型武器的研制，优化系统设计，提高武器系统性能；以及诊断并排除隐患和故障、提高型号研制质量；大大减少实弹试验次数和试验数量，从而起到了缩短研制周期、节约研制经费、提高武器系统效费比的巨大作用。秦建东[14]、王书齐[11]等人提出首先利用UML建立实体关系模型，为战场关系进行梳理，清晰敌我态势。王书齐[11]、徐永杰[12]等人已经提出战场仿真系统的关键流程，Zhang Xiaoying[5]开发了一个数字试验场，并以HLA的基本概念、方法和原理为基础，分析了该试验场的功能和特点，同时对分布式数字试验场导弹穿透仿真系统的系统设计进行了改进。徐建志[7]、陈军[8]、王孟名[9]申周[23]等人均利用STAGE开发工具包对不同的战场情况进行了成功的仿真模拟。王勃[17]等人利用当下热门技术VR对海战防空虚拟训练进行了探索，VR技术在武器系统性能评价、武器操作训练、指挥大规模军事演习等三个方面的仿真应用中能发挥重大作用：大幅度降低所需的费用，极大的提高效益，并消除意外伤亡事故。江波[24]等人采用了Unity技术，简要分析了基于Unity3D引擎显示系统的特点与优势,详细阐述了利用Unity3D构建显示系统的方法;然后,分别对数据库连接优化、定时驱动以及姿态调整等关键技术进行了详细的分析，并较好地完成实时三维态势显示的目的。
在未来，运用计算机进行武器系统训练仿真、环境仿真、分布交互式仿真、虚拟现实仿真等将成为主流，建立相应的仿真试验系统，系统仿真支撑环境，充分发挥仿真技术简单高效的优点，逐渐完成各类型战场的研制与试验、定型与评估、使用与训练、更新与改造工作，成为武器系统研制和军队建设的重要手段。
-2020.4.20

2.1.1系统整体架构
在系统底层是数据资源层，包括模型文件和资源文件，Unity3D引擎本质上是通过脚本对这些模型和资源进行操作和处理，底层中还有数据库文件，数据库中目前存储有任务列表、舰船生成任务列表、敌方攻击任务列表、友方火炮反击任务列表、友方舰船移动任务列表。其中整个数据库中以唯一任务id区分。
系统第二层为三维引擎层，包括Unity3D三维引擎和VS平台作为开发环境，主要在这一层实现系统功能区分和实现。
系统第三层为应用层，这一层为所开发的系统，能完成需求分析中所要求的功能，为外界提供三个主要功能：作战参数输入和修改、三维实景展示、二维态势展示、防空效能评价功能。

2.1.2系统功能模块设计
到目前，所开发的舰队联合防空仿真分为六个模块，分别是作战想定输入模块、预警模块、指挥决策模块、舰艇控制模块、武器系统模块、防空效能评估模块。各模块相关功能可见下图。

2.1.3数据库设计
作战数据库是整个系统中至关重要的部分，此系统到目前为止共有四张表：
①	all_task系统所有任务表
②	weapon_task武器系统表
③	move_task舰船移动数据表
④	addobj_task动态添加舰船信息表
这四张表中均以all_task为参考表，均以id为主键唯一标识符号。
各表中index如下图：
 
优化数据库效率的方法：
①	将对数据库进行操作的方法封装为单例类，对外提供统一的接口
②	使用数据库连接池，节约打开和关闭数据库操作所耗费的资源
3.当前进度
通过模拟系统运行过程，逐步完善系统运行过程中的各个模块。
 
作战任务添加模块：在仿真系统运行最开始，需要输入作战想定参数，目前所能实现的输入参数有：友方舰艇按照位置添加、敌方导弹按照时间和方位设定，主体功能已经完善，在作战任务添加完成后，系统将所有任务添加至作战数据库中以供仿真系统运行使用。
自动控制脚本：由于整个系统在仿真过程中是不需要人为手动操作的，因此需要利用自动控制脚本来进行控制，其基本原理是通过整个仿真系统所设定的时间自动获取所有任务，然后根据任务类型对任务进行分发，驱动程序运行。
目前所能实现的三个主要功能是：敌机攻击功能、友方拦截敌方导弹功能、友方目标舰艇根据来袭目标规避功能。敌机攻击功能：通过自动控制脚本所下达的任务编号，在达到作战想订时输入的预设时间时请求武器系统数据库获取该任务编号的具体信息，包括发射敌机编号、目标等等，获取之后执行攻击任务；友方拦截功能：在敌军导弹发射之后，如果导弹飞行进入友方预警机检测范围，则会启动指挥控制系统，指控系统根据一系列联合算法对来袭的该导弹进行目标判定、威胁评估之后生成拦截方案以及舰艇规避方案（这部分具体算法目前尚未完成），拦截方案和舰艇规避方案在生成后会进入择机执行状态（初步想法是简历任务执行池，结合火力的重调度算法高效执行）最后将会执行拦截或舰艇规避任务，待任务执行完毕之后，对执行结果做一个评估，如果拦截成功则完成任务，拦截不成功则将该目标视为新出现目标即可。
-2020.4.14

添加堆结构对任务进行优先级调度，堆调整的key为威胁评估系统评价出来的优先级（值），但需要具体实现。
-2020.4.16

为打击资源、制导资源、探测资源添加辅助射线，可见图4.17，同时优化部分代码（数据库模块、内存管理），游戏运行更加流畅稳定。
-2020.4.17

实现任务堆的创建，调整，弹出任务级别最高的任务节点并分配制导资源、打击资源进行来接，对于来袭目标有三种可能情况：1.新目标出现（威胁程度更高），因为堆的上浮机制可迅速达到触发条件；2.拦截目标失败，则将该目标的现有威胁程度x2,然后直接加入任务堆，跟情况1类似；3.拦截目标成功，则立即释放制导资源和预警资源，打击资源在拦截导弹发射两秒之后自动释放。
对部分流程进行重新设计，使之更符合实战条件之下的战术过程。
经过压力测试，在六艘舰艇，每艘舰艇打击资源1，制导资源3，预警资源3的情况下，在敌方4分钟内连续攻击50次，我方打击敌军100次的情况下，我方目标送受损率不足5%，优秀！部分运行截图可如4.18
-2020.4.18

制定规则：
1.敌军出现进入防空识别区时即可开始预警
2.随时间增加敌军目标（飞机、导弹）的威胁程度
3.各目标威胁程度>系统设定阈值时触发拦截机制，分配制导资源x2，打击资源x1
4.预警资源在敌军目标消失前一直保持跟踪，制导资源在敌军被击毁之前一直保持跟踪，打击资源在发射2s后释放
5.拦截导弹失败后导弹威胁值x2，如果导弹距离不足3000m时威胁值直接+800（这样可以以最大速度重新拦截目标）
6.maybe more
2020.4.19

添加功能:
1.显示当前防空系统的资源消耗量，可见图4.21
2.对战斗产生的数据进行读取，便于后续对于防空效能的分析
3.优化防空算法，使系统导弹拦截成功率提升10%，目前防空效果敌军50次攻击，造成我方被击中概率为2%以下，且可以出现无一击中的现象
4.界面ui需要进一步完善
2020.4.21